Communication Protocol
======================

The system acts as a DALI master so it can send/receive
DALI commands to/from its slaves according to an host system's
commands.

Here the communication protocol between the host command and the DALI system.

The communication port is a standard UART at 115200 8N1.

Each command is syncronous, that is for each command we should get an
answer before the cmd_answer_timeout time expires. If we get no
answers before the cmd_answer_timeout time and after cmd_answer_retries
retries the system must be considered faulty.

By default for all commands the cmd_answer_timeout
is set to 200ms and cmd_answer_retries is set to 5.

All commands/answers are strings written in ASCII terminated by
'\n' (max lenght is 128 bytes).

For telnet compatibility the sequence "\r\n" is accepted as "\n".

All answers are in this form:

	TXXX..XXX\n

where:

 - T: the type of answer, where 'O' is for ok and 'E' is for error

 - X: an optional argument byte 



Remap Commands:
---------------

- remap all: start remapping all slaves on bus.

        ra\n

- remap unknown: start remapping slaves which do not have assigned short addresses.

        ru\n

- remap start: start remapping all slaves starting from address XX

        rsXX\n

- remap move: change slave address from short address YY to short address ZZ

        rmYYZZ\n

- remap progress: check on remap progress

        rp\n

	The answer byte is 0x00 for "yes" and a value from 1 to 100 for "no" representing the percentage
	of accomplished job.

	For this command the answer timeout is 500ms.

- remap abort: abort remap process

        rA\n


Configuration Commands
-----------------------

- configure minimum level at value YYY address XX

        cmXXYYY\n

- configure maximum level at value YYY address XX

        cxXXYYY\n

         Example - cx16250\n (Set maximum level of 250 out of 254 for address 16)

- configure system fail level at value YYY address XX

        cfXXYYY\n

- configure power on level at value YYY address XX

        cfXXYYY\n

- configure fade time at value YYY address XX

        ctXXYYY\n

- configure fade rate at value YYY address XX

        crXXYYY\n

Device Commands:
----------------

- device ON at address XX

        d1XX\n

	Turn on light (or whatever) on the slave device.

- device OFF at address XX

        d0XX\n

	Turn off light (or whatever) on the slave device.

- device SET ARC at value YYY address XX

        daXXYYY\n

	Set the arc light (or whatever) at specified power on the slave device.

- device INFO at address XX

	diXX\n
	
	Get device info
	
- device INFO for all addresses

	dia\n
	
	Get device info for all addresses

Group Device Commands:
----------------------

- group ON for group XX

        g1XX\n

	Turn on light (or whatever) on all slave devices in group XX.

- group OFF for group XX

        g0XX\n

	Turn off light (or whatever) on all slave devices in group XX.

- group SET ARC at value YYY for group XX

        gaXXYYY\n

	Set the arc light (or whatever) at specified power on all slave devices in a group.


Bus Commands:
-------------

- bus set all ON

        b1\n 

	Turn on light (or whatever) on all slaves on bus.


- bus set all OFF

        b0\n 

	Turn off light (or whatever) on all slaves on bus.


- bus set arc at YYY on all slaves on bus

        baYYY\n

	Set the arc light (or whatever) at specified power on all slave devices on bus.

- bus list of all slaves from memory

        bl\n

	The answer is a 65 bytes long string where:

	* the first element is the return code,

	* the i-th element is not 0 if the i-th slave device is present on the bus. 

- bus scan of all slaves

        bs\n 

	Initiates a scan of all slaves on the bus
	
	The answer is a 65 bytes long string where:

	* the first element is the return code,

	* the i-th element is not 0 if the i-th slave device is present on the bus.

Error codes
-----------

Here a list of the error codes whose each DALI command can return.

=== Invalid command (0x01)

The submitted command is not valid.

=== Unsupported command (0x02)

The submitted command is not been implemented yet.

=== Bus busy (0x03)

The submitted command cannot be executed because the master is busy.

=== Invalid BUS ID (0x20)

The submitted bus ID is not valid.

=== Invalid DEV address (0x30)

Does not exist any device at this DEV address.

=== Timeout (0x90)

Returned each time a timeout expires.
